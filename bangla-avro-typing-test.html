<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>Bangla Avro Typing Test - 2 লাইন + ১ মিনিট</title>
<!-- Web-friendly SolaimanLipi font -->
<style>
@font-face {
  font-family: 'SolaimanLipi';
  src: url('https://cdn.jsdelivr.net/gh/username/fonts/SolaimanLipi.ttf') format('truetype');
}
body { font-family: 'SolaimanLipi', sans-serif; padding: 20px; }
#passageContainer { border: 1px solid #ccc; padding: 15px; width: 700px; height: 100px; overflow: hidden; font-size: 20px; line-height: 1.6; }
.line { height: 50px; }
#typingArea { width: 700px; height: 80px; font-size: 20px; padding: 10px; margin-top: 10px; }
.correct { color: green; }
.mistake { background-color: #fdd; }
#info { margin-top: 10px; font-size: 18px; }
button { padding: 8px 16px; font-size: 16px; margin-top: 10px; }
</style>
</head>
<body>

<h2>বাংলা Avro Typing Test (২ লাইন + ১ মিনিট)</h2>

<div id="passageContainer">
  <div class="line" id="line1"></div>
  <div class="line" id="line2"></div>
</div>

<textarea id="typingArea" placeholder="এখানে টাইপ করুন..." autofocus></textarea>
<br>
<button id="resetBtn">রিসেট</button>
<div id="info">সময়: 1:00 | WPM: 0 | Accuracy: 100%</div>

<script>
const fullText = `আমাদের প্রতিটি প্রোডাক্ট গুণগত মান যাচাই করে বাজারজাত করা হয়। বাজারের অন্যান্য প্রোডাক্ট এর থেকে কার্যকারিতাও অনেক বেশি। আমাদের প্রোডাক্টটি ব্যবহার করে অনেক মানুষ উপকৃত হয়েছে। ইনগ্রেডিয়েন্স অর্গানিক এবং বিদেশী ফর্মুলায় তৈরী। কোনো পার্শ্বপ্রতিক্রিয়া নেই। নিয়মিত ব্যবহারে ত্বকে গোলাপি আভা আসে।`;

const words = fullText.split(" ");
let currentWordIndex = 0;
let startTime = null;
let remainingTime = 60;
let timerInterval = null;

const line1Div = document.getElementById('line1');
const line2Div = document.getElementById('line2');
const typingArea = document.getElementById('typingArea');
const infoDiv = document.getElementById('info');

function getLine(startIndex, numWords=5) {
  return words.slice(startIndex, startIndex + numWords).join(" ");
}

function updateLines() {
  line1Div.innerText = getLine(currentWordIndex);
  line2Div.innerText = getLine(currentWordIndex + 5);
}

function calculateStats() {
  const typed = typingArea.value.trim();
  let mistakes = 0;
  const currentLineText = getLine(currentWordIndex, 5);
  for(let i=0; i<typed.length; i++) {
    if(typed[i] !== currentLineText[i]) mistakes++;
  }
  const typedWords = typed.length ? typed.split(/\s+/).length : 0;
  const accuracy = typed.length ? Math.round(((typed.length - mistakes)/typed.length)*100) : 100;
  return {wpm: typedWords, accuracy};
}

function finishTest() {
  typingArea.disabled = true;
  clearInterval(timerInterval);
  const typedText = typingArea.value.trim();
  const totalTypedWords = typedText.split(/\s+/).filter(w=>w).length + currentWordIndex;
  const stats = calculateStats();
  infoDiv.innerText = `সময় শেষ! | Final WPM: ${totalTypedWords} | Accuracy: ${stats.accuracy}%`;
}

function startTimer() {
  timerInterval = setInterval(() => {
    remainingTime--;
    const stats = calculateStats();
    let minutes = Math.floor(remainingTime / 60);
    let seconds = remainingTime % 60;
    seconds = seconds < 10 ? '0'+seconds : seconds;
    infoDiv.innerText = `সময়: ${minutes}:${seconds} | WPM: ${currentWordIndex + stats.wpm} | Accuracy: ${stats.accuracy}%`;
    if (remainingTime <= 0) finishTest();
  }, 1000);
}

function resetTest() {
  currentWordIndex = 0;
  remainingTime = 60;
  typingArea.value = "";
  typingArea.disabled = false;
  startTime = null;
  clearInterval(timerInterval);
  updateLines();
  infoDiv.innerText = "সময়: 1:00 | WPM: 0 | Accuracy: 100%";
}

typingArea.addEventListener('keydown', () => {
  if (!startTime) {
    startTime = new Date();
    startTimer();
  }
});

typingArea.addEventListener('input', () => {
  const typed = typingArea.value.trim();
  const currentLineText = getLine(currentWordIndex, 5);
  let html = "";
  for (let i=0; i<currentLineText.length; i++) {
    if (typed[i]==null) html += currentLineText[i];
    else if (typed[i] === currentLineText[i]) html += `<span class="correct">${currentLineText[i]}</span>`;
    else html += `<span class="mistake">${currentLineText[i]}</span>`;
  }
  line1Div.innerHTML = html;

  if (typed === currentLineText) {
    currentWordIndex += 5;
    typingArea.value = "";
    line1Div.innerText = line2Div.innerText;
    line2Div.innerText = getLine(currentWordIndex + 5);
  }
});

document.getElementById('resetBtn').addEventListener('click', resetTest);

updateLines();
</script>

</body>
</html>
